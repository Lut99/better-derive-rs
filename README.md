# better-derive-rs
A small Rust crate that provides alternatives for Rust's builtin `Clone`-, `Copy`-, `Debug`-, `Eq`-, `Hash`-, `Ord`-, `PartialEq`- and `PartialOrd`-derive macros that apply more accurate trait bounds for generated impls.


## Installation
To use the crate, simply add it to your `Cargo.toml`:
```toml
better-derive = { git = "https://github.com/Lut99/better-derive-rs" }
```

You can also use a specific version by adding the appropriate tag:
```toml
better-derive = { git = "https://github.com/Lut99/better-derive-rs", tag = "v3.0.1" }
```


## Usage
This crate is supposed to be a drop-in replacement of the builtin macro counterparts.

The only difference are the generic bounds generated by the macro: instead of generating an e.g. `Debug`-bound on all _generics_, it generates it for all _fields types_.

For example:
```rust
use std::fmt::{Debug, Formatter, Result as FResult};
use std::marker::PhantomData;

struct Foo<T>(PhantomData<T>);

// Generated by the builtin
impl<T> Debug for Foo<T>
where
    T: Debug,
{
    fn fmt(&self, f: &mut Formatter) -> FResult { /* ... */ }
}

// Generated by our macro
impl<T> Debug for Foo<T>
where
    PhantomData<T>: Debug,
{
    fn fmt(&self, f: &mut Formatter) -> FResult { /* ... */ }
}
```
Since `PhantomData` implements `Debug` regardless of whether `T` does, this means that this property holds for `Foo` as well.

### Supported macros
The following macros find a counterpart in this crate:
- `Clone`
- `Copy`
- `Debug`
- `Eq`
- `Hash`
- `Ord`
- `PartialEq`
- `PartialOrd`

There are also some macros for other crates, unlocked by feature:
- [_serde_](https://serde.rs):
  - `Serialize`

### All macros: Defining bounds
By default, the generated impls generate bounds of the shape for e.g. `Clone` as follows:
```plain
TYPE: Clone,
```
for every type `TYPE` somehow a field of your base object (directly or in a variant) that depends on a generic. If this doesn't suit your needs, you can define your own bounds using the following attributes:
1. `#[TRAIT(impl_gen = <...>)]`, where `TRAIT` is one of the traits or `better_derive` to define it for all those derived, defines the generics that are available in the custom implementation. I.e., it is the one immediately following `impl` in an `impl`-signature. If you're defining bounds, you can use `r#trait` to refer to the "current" trait (useful in case you're using `better_derive`).

   By default, when omitted, this defaults to whatever you give in your implementation.
2. `#[TRAIT(type_gen = <...>)]`, where `TRAIT` is one of the traits or `better_derive` to define it for all those derived, defines the generic arguments passed to your type. I.e., it is the one immediately following your type name in an `impl`-signature.

   By default, when omitted, this defaults to the subset of `impl_gen` that is present in the derived object's bounds (i.e., only `'a` and `T` in `struct Foo<'a, T>`).
3. `#[TRAIT(bound = (...))]`, where `TRAIT` is one of the traits or `better_derive` to define it for all those derived, defines additional `where` clauses to put on the generics defined by `impl_gen`. You can use `r#trait` to refer to the "current" trait (useful in case you're using `better_derive`).

   By default, defaults to a list of all field types (directly or in variants) of your derived object which refer to one of the parameters in `impl_gen`, with a restriction that they must implement `r#trait`. I.e., the default behaviour describes above.

See the [`custom.rs`](./examples/custom.rs)-example in the repository.

### `Debug`, `Hash`, `PartialEq`, `PartialOrd` and `Serialize`: Skipping fields
The `Debug`-, `Hash`-, `PartialEq`-, `PartialOrd`- and `Serialize` derive macros have some additional functionality: you can optionally ignore fields in the generated implementation.
Specifically, you can annotate fields with `#[debug(skip)]`, `#[hash(skip)]`, `#[partial_eq(skip)]` and/or `#[serialize(skip)]`, respectively, to have it omitted.

See the respective macro's docs for more information, or see the [`skip.rs`](./examples/skip.rs)-example in the repository.

### Features
This crate supports the following features:
- `serde`: Unlock the `Serialize`-macro.
  - Note that the generated impls will depend on _your own_ serde dependency. You may get some funky errors if you forget to include it, so always do that first.

### Documentation
The auto-generated code documentation can be generated by running:
```sh
cargo doc --no-deps --open
```
This will automatically open the resulting web pages with your default browser.

### Examples
For more examples, see the `examples/`-folder in the main repository.


## Contributing
Contributions are welcome! Feel free to [raise an issue](https://github.com/Lut99/better-derive-rs/issues) or [create a pull request](https://github.com/Lut99/better-derive-rs/pulls).


## License
This project is licensed under the Apache 2.0 license. See [`LICENSE/`](./LICENSE) for more details.
